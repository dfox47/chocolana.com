{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <a onclick="$('#form-econt :input').removeAttr('disabled'); $('#form-econt').submit();" class="btn btn-primary">{{ button_generate }}</a>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
     <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
	 <div class="panel-heading">
		<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ heading_title }}</h3>
     </div>
     <div class="panel-body">
      <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-econt" class="form-horizontal">
        <div class="panel-body">
          <div class="form-group">
            <div class="col-sm-3"></div>
            <div class="col-sm-9"><h3>{{ entry_receiver_address }}</h3></div>
          </div>
          <div class="form-group" {% if not receiver_address['to_door'] or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label">{{ text_receiver_shipping_to }}</label>
            <div class="col-sm-9">
              <label class="radio-inline" style="display: inline; width: auto; float: none;">
                <input type="radio" id="to_door" name="shipping_to" value="DOOR" {% if receiver_address['shipping_to'] == 'DOOR' %}checked="checked"{% endif %} onclick="$('#econt_office_city_id,#econt_office_city_aps_id,#econt_office_id,#econt_office_aps_id,#econt_office_code,#econt_office_aps_code,#econt_office_locator').hide(); $('#econt_post_code,#econt_city,#econt_quarter,#econt_street,#econt_street_num,#econt_other,#services_door,#econt_oc,#econt_pack_count').show();" />
                {{ text_to_door }}
              </label>
              <label class="radio-inline" style="display: inline; width: auto; float: none;">
                <input type="radio" id="to_office" name="shipping_to" value="OFFICE" {% if receiver_address['shipping_to'] == 'OFFICE' %}checked="checked"{% endif %} onclick="$('#econt_office_city_id,#econt_office_id,#econt_office_code,#econt_office_locator,#econt_oc,#econt_pack_count').show();$('#econt_post_code,#econt_city,#econt_quarter,#econt_street,#econt_street_num,#econt_other,#services_door,#econt_office_city_aps_id,#econt_office_aps_id,#econt_office_aps_code').hide();" />
                {{ text_to_office }}
              </label>
              <label class="radio-inline" style="display: inline; width: auto; float: none;">
                <input type="radio" id="to_aps" name="shipping_to" value="APS" {% if receiver_address['shipping_to'] == 'APS' %}checked="checked"{% endif %} onclick="$('#econt_office_city_aps_id,#econt_office_aps_code,#econt_office_aps_id,#aps_info').show();$('#econt_post_code,#econt_city,#econt_quarter,#econt_street,#econt_street_num,#econt_other,#services_door,#econt_office_locator,#econt_office_city_id,#econt_office_id,#econt_office_code,#econt_oc,#econt_pack_count').hide();" />
                {{ text_to_aps }}
              </label>
            </div>
          </div>
          <div class="form-group" id="econt_post_code" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="post_code">{{ text_receiver_postcode }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="post_code" name="post_code" value="{{ receiver_address['post_code'] }}" size="3" readonly="readonly" />
			</div>
          </div>
          <div class="form-group" id="econt_city" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="city">{{ text_receiver_city }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="city" name="city" value="{{ receiver_address['city'] }}" />
              <input class="form-control" type="hidden" id="city_id" name="city_id" value="{{ receiver_address['city_id'] }}" />
			</div>
          </div>
          <div class="form-group" id="econt_quarter" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="quarter">{{ text_receiver_quarter }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="quarter" name="quarter" value="{{ receiver_address['quarter'] }}" />
			</div>
          </div>
          <div class="form-group" id="econt_street" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="street">{{ text_receiver_street }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="street" name="street" value="{{ receiver_address['street'] }}" />
			</div>
          </div>
          <div class="form-group" id="econt_street_num" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="street_num">{{ text_receiver_street_num }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="street_num" name="street_num" value="{{ receiver_address['street_num'] }}" />
			</div>
          </div>
          <div class="form-group" id="econt_other" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="other">{{ text_receiver_other }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="other" name="other" value="{{ receiver_address['other'] }}" />
              {% if error_receiver_address %}
              <br />&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_receiver_address }}</span>
              {% endif %}
            </div>
          </div>
          <div class="form-group" id="econt_office_city_id" {% if receiver_address['shipping_to'] != 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_city_id">{{ text_receiver_city }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="office_city_id" name="office_city_id" onchange="getOfficesByCityId(0);">
				<option value="0">{{ text_select }}</option>
				{% for city in receiver_address['cities'] %}
				{% if receiver_address['office_city_id'] is defined and city['city_id'] == receiver_address['office_city_id'] %}
				<option value="{{ city['city_id'] }}" selected="selected">{{ city['name'] }}</option>
				{% else %}
				<option value="{{ city['city_id'] }}">{{ city['name'] }}</option>
				{% endif %}
				{% endfor %}
              </select>
			</div>
          </div>
          <div class="form-group" id="econt_office_city_aps_id" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] != 'APS' or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_city_aps_id">{{ text_receiver_city }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="office_city_aps_id" name="office_city_aps_id" onchange="getOfficesByCityId(1);">
				<option value="0">{{ text_select }}</option>
				{% for city in receiver_address['cities_aps'] %}
				{% if receiver_address['office_city_aps_id'] is defined and city['city_id'] == receiver_address['office_city_aps_id'] %}
				<option value="{{ city['city_id'] }}" selected="selected">{{ city['name'] }}</option>
				{% else %}
				<option value="{{ city['city_id'] }}">{{ city['name'] }}</option>
				{% endif %}
				{% endfor %}
              </select>
			</div>
          </div>
          <div class="form-group" id="econt_office_id" {% if receiver_address['shipping_to'] != 'OFFICE' or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_id">{{ text_receiver_office }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="office_id" name="office_id" onchange="getOffice(0);">
				<option value="0">{{ text_select }}</option>
				{% for office in receiver_address['offices'] %}
				{% if office['office_id'] == receiver_address['office_id'] %}
				<option value="{{ office['office_id'] }}" selected="selected">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
				{% else %}
				<option value="{{ office['office_id'] }}">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
				{% endif %}
				{% endfor %}
			  </select>
			  {% if error_receiver_office %}
			  <br />&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_receiver_office }}</span>
			  {% endif %}
            </div>
          </div>
          <div class="form-group" id="econt_office_aps_id" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] != 'APS' or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_aps_id">{{ text_receiver_office }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="office_aps_id" name="office_aps_id" onchange="getOffice(1);">
				<option value="0">{{ text_select }}</option>
				{% for office in receiver_address['offices_aps'] %}
				{% if office['office_id'] == receiver_address['office_aps_id'] %}
				<option value="{{ office['office_id'] }}" selected="selected">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
				{% else %}
				<option value="{{ office['office_id'] }}">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
				{% endif %}
				{% endfor %}
			  </select>
			  {% if error_receiver_office %}
			  <br />&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_receiver_office }}</span>
			  {% endif %}
            </div>
          </div>
          <div class="form-group" id="econt_office_code" {% if receiver_address['shipping_to'] != 'OFFICE' or not receiver_address[ 'to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_code">{{ text_receiver_office_code }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="office_code" name="office_code" value="{{ receiver_address['office_code'] }}" size="3" readonly="readonly" />
			</div>
          </div>
          <div class="form-group" id="econt_office_aps_code" {% if receiver_address['shipping_to'] != 'APS' or not receiver_address[ 'to_aps'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="office_aps_code">{{ text_receiver_office_code }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="office_aps_code" name="office_aps_code" value="{{ receiver_address['office_aps_code'] }}" size="3" readonly="readonly" />
			</div>
          </div>
          <div class="form-group" id="econt_office_locator" {% if receiver_address['shipping_to'] != 'OFFICE' or not receiver_address['to_office'] %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label">&nbsp;</label>
            <div class="col-sm-9">
			  <a href="javascript:void(0);" id="office_locator" class="btn btn-primary"><span>{{ button_office_locator }}</span></a>
			</div>
          </div>
          <div class="form-group">
            <div class="col-sm-3"></div>
            <div class="col-sm-9"><h3>{{ entry_sender_data }}</h3></div>
          </div>
					{% if shipping_from == 'OFFICE' %}
					<div class="form-group" id="office_city_id">
            <label class="col-sm-3 control-label" for="econt_office_city_id">{{ text_receiver_city }}</label>
            <div class="col-sm-9">
              <select class="form-control" id="econt_office_city_id_sender" name="shipping_econt_office_city_id" onchange="getOfficesByCityId(0, true);">
                <option value="0">{{ text_select }}</option>
                {% for city in cities %}
                {% if city['city_id'] == shipping_econt_office_city_id %}
                <option value="{{ city['city_id'] }}" selected="selected">{{ city['name'] }}</option>
                {% else %}
                <option value="{{ city['city_id'] }}">{{ city['name'] }}</option>
                {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group" id="office_id">
            <label class="col-sm-3 control-label" for="econt_office_id">{{ text_receiver_office }}</label>
            <div class="col-sm-9">
              <select class="form-control" id="econt_office_id_sender" name="shipping_econt_office_id" onchange="getOffice(0, true);" style="width: 400px;">
                <option value="0">{{ text_select }}</option>
                {% for office in offices %}
                {% if office['office_id'] == shipping_econt_office_id %}
                <option value="{{ office['office_id'] }}" selected="selected">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
                {% else %}
                <option value="{{ office['office_id'] }}">{{ office['office_code'] }}, {{ office['name'] }}, {{ office['address'] }}</option>
                {% endif %}
                {% endfor %}
              </select>
              {% if error_office %}
              <span class="text-danger">{{ error_office }}</span>
              {% endif %}
            </div>
          </div>
          <div class="form-group" id="office_code_sender">
            <label class="col-sm-3 control-label">{{ text_receiver_office_code }}</label>
            <div class="col-sm-9">
              <input type="text" id="econt_office_code_sender" name="shipping_econt_office_code" value="{{ shipping_econt_office_code }}" size="3" readonly placeholder="{{ shipping_econt_office_code }}" class="form-control" />
            </div>
          </div>
					{% else %}
          <div class="form-group">
            <label class="col-sm-3 control-label" for="address_id">{{ entry_address }}</label>
							<div class="col-sm-9">
								<select class="form-control" id="address_id" name="address_id">
								{% for address in addresses %}
								{% if address['address_id'] == address_id %}
									<option value="{{ address['address_id'] }}" selected="selected">{{ address['name'] }}</option>
								{% else %}
									<option value="{{ address['address_id'] }}">{{ address['name'] }}</option>
								{% endif %}
								{% endfor %}
								</select>
								{% if error_address %}
								<span class="text-danger">{{ error_address }}</span>
								{% endif %}
							</div>
          </div>
					{% endif %}
          {% if products_weight %}
          <div class="form-group">
            <label class="col-sm-3 control-label">{{ entry_products_weight }}</label>
            <div class="col-sm-9">
			  {% for product_weight in products_weight %}
              [ <a href="{{ product_weight['href'] }}" target="_blank">{{ product_weight['text'] }}</a> ]
              {% endfor %}
              {% if error_products_weight %}
              <span class="text-danger">{{ error_products_weight }}</span>
              {% endif %}
			</div>
          </div>
          {% endif %}
          <div class="form-group">
            <label class="col-sm-3 control-label" for="invoice_before_cd">{{ entry_invoice_before_cd }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="invoice_before_cd" name="invoice_before_cd">
				{% if invoice_before_cd %}
				<option value="1" selected="selected">{{ text_yes }}</option>
				<option value="0">{{ text_no }}</option>
				{% else %}
				<option value="1">{{ text_yes }}</option>
				<option value="0" selected="selected">{{ text_no }}</option>
				{% endif %}
              </select>
			</div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label" for="econt_dc">{{ entry_dc }}</label>
            <div class="col-sm-9">
              <select class="form-control" id="econt_dc" name="shipping_econt_dc">
                {% if shipping_econt_dc == 2 %}
                <option value="2" selected="selected">{{ text_yes_return_receipt }}</option>
                <option value="1">{{ text_yes_receipt }}</option>
                <option value="0">{{ text_no }}</option>
                {% elseif shipping_econt_dc == 1 %}
                <option value="2">{{ text_yes_return_receipt }}</option>
                <option value="1" selected="selected">{{ text_yes_receipt }}</option>
                <option value="0">{{ text_no }}</option>
                {% else %}
                <option value="2">{{ text_yes_return_receipt }}</option>
                <option value="1">{{ text_yes_receipt }}</option>
                <option value="0" selected="selected">{{ text_no }}</option>
                {% endif %}
              </select>
              <div><a href="http://www.econt.com/tariff-parcel/" target="_blank">{{ text_learn_more }}</a></div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">{{ entry_disposition }}</label>
            <div class="col-sm-9">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="econt_pay_after_accept" name="pay_after_accept" value="1" {% if pay_after_accept %} checked="checked"{% endif %} onchange="if (!$(this).is(':checked')) { $('#pay_after_test').prop('checked', false); $('#pay_choose').prop('checked', false); }" />
                  {{ entry_pay_after_accept }}
                </label>
              </div>
              <div class="checkbox">
                <label>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="pay_after_test" name="pay_after_test" value="1" {% if pay_after_test %} checked="checked"{% endif %} onchange="if ($(this).is(':checked')) { $('#econt_pay_after_accept').prop('checked', true); }" />
                  {{ entry_pay_after_test }}
                </label>
              </div>
              <div class="checkbox">
                <label>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="pay_choose" name="pay_choose" value="1" {% if pay_choose %} checked="checked"{% endif %} onchange="if ($(this).is(':checked')) { $('#econt_pay_after_accept').prop('checked', true); }" />
                  {{ entry_pay_choose }}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="panel-body" id="services_door" {% if receiver_address['shipping_to'] == 'OFFICE' or receiver_address['shipping_to'] == 'APS' or not receiver_address['to_door'] %} style="display: none;"{% endif %}>
          <div class="form-group">
            <label class="col-sm-3 control-label">
              <input type="checkbox" id="priority_time_cb" name="priority_time_cb" value="1" {% if priority_time_cb %} checked="checked"{% endif %} onclick="checkPriorityTime();" />
              {{ entry_priority_time }}
            </label>
            <div class="col-sm-3">
              <select class="form-control" id="priority_time_type_id" name="priority_time_type_id" {% if not priority_time_cb %} disabled="disabled"{% endif %}>
                {% set priority_time_hours = "" %}
                {% for priority_time_type in priority_time_types %}
                {% if priority_time_type['id'] == priority_time_type_id %}
                {% set priority_time_hours = priority_time_type['hours'] %}
                <option value="{{ priority_time_type['id'] }}" selected="selected">{{ priority_time_type['name'] }}</option>
                {% else %}
                <option value="{{ priority_time_type['id'] }}">{{ priority_time_type['name'] }}</option>
                {% endif %}
                {% endfor %}
              </select>
            </div>
            <div class="col-sm-3">
              <select class="form-control" id="priority_time_hour_id" name="priority_time_hour_id"{% if not priority_time_cb %} disabled="disabled"{% endif %}>
                {% for priority_time_hour in priority_time_hours %}
                {% if priority_time_hour == priority_time_hour_id %}
                <option value="{{ priority_time_hour }}" selected="selected">{{ priority_time_hour }} {{ text_hour }}</option>
                {% else %}
                <option value="{{ priority_time_hour }}">{{ priority_time_hour }} {{ text_hour }}</option>
                {% endif %}
                {% endfor %}
              </select>
            </div>
            <div class="col-sm-3">
              {% if error_priority_time %}
              <span class="text-danger">{{ error_priority_time }}</span>
              {% endif %}
            </div>
          </div>
        </div>
        {% if shipping_restday %}
        <div class="form-group">
          <label class="col-sm-3 control-label" for="shipping_restday">{{ entry_deliver_in }}</label>
          <div class="col-sm-9">
            <select class="form-control" id="shipping_restday" name="shipping_restday">
              {% if shipping_restday %}
              <option value="1" selected="selected">{{ text_saturday }}</option>
              <option value="0">{{ text_monday }}</option>
              {% else %}
              <option value="1">{{ text_saturday }}</option>
              <option value="0" selected="selected">{{ text_monday }}</option>
              {% endif %}
            </select>
          </div>
        </div>
        {% endif %}
		  {% if shipping_from != 'APS' %}
          <div class="form-group" id="econt_pack_count" {% if receiver_address['shipping_to'] == 'APS' %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="pack_count">{{ entry_pack_count }}</label>
            <div class="col-sm-9">
			  <input class="form-control" type="text" id="pack_count" name="pack_count" value="{{ pack_count }}" />
			</div>
          </div>
		  {% endif %}
          <div class="form-group" {% if products_count <= 1 %} style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="partial_delivery">{{ entry_partial_delivery }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="partial_delivery" name="partial_delivery" onchange="$('#pd_instruction').toggle();">
				{% if partial_delivery %}
				<option value="1" selected="selected">{{ text_yes }}</option>
				<option value="0">{{ text_no }}</option>
				{% else %}
				<option value="1">{{ text_yes }}</option>
				<option value="0" selected="selected">{{ text_no }}</option>
				{% endif %}
              </select>
			  <input class="form-control" type="hidden" name="products_count" value="{{ products_count }}" />
			</div>
          </div>
          <div class="form-group" id="pd_instruction" {% if not partial_delivery or products_count <= 1 %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="partial_delivery_instruction">{{ entry_partial_delivery_instruction }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="partial_delivery_instruction" name="partial_delivery_instruction">
				{% for value in partial_delivery_instructions %}
				{% if value['code'] == partial_delivery_instruction %}
				<option value="{{ value['code'] }}" selected="selected">{{ value['title'] }}</option>
				{% else %}
				<option value="{{ value['code'] }}">{{ value['title'] }}</option>
				{% endif %}
				{% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group" id="econt_inventory">
            <label class="col-sm-3 control-label" for="inventory">{{ entry_inventory }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="inventory" name="inventory" onchange="$('#inventory_types').toggle();">
				{% if inventory %}
				<option value="1" selected="selected">{{ text_yes }}</option>
				<option value="0">{{ text_no }}</option>
				{% else %}
				<option value="1">{{ text_yes }}</option>
				<option value="0" selected="selected">{{ text_no }}</option>
				{% endif %}
              </select>
			</div>
          </div>
          <div class="form-group" id="inventory_types" {% if not inventory %}style="display: none;"{% endif %}>
            <label class="col-sm-3 control-label" for="inventory_type">{{ entry_inventory_type }}</label>
            <div class="col-sm-9">
			  <select class="form-control" id="inventory_type" name="inventory_type" onchange="displayInventoryType();">
                {% for value in inventory_types %}
                {% if value['code'] == inventory_type %}
				<option value="{{ value['code'] }}" selected="selected">{{ value['title'] }}</option>
				{% else %}
				<option value="{{ value['code'] }}">{{ value['title'] }}</option>
				{% endif %}
				{% endfor %}
              </select>
			  <span id="inventory_type_loading" {% if inventory_type != 'LOADING' %}style="display: none;"{% endif %}>{{ text_loading_note }}</span>
              <table class="table table-bordered table-hover" id="inventory_type_digital" style="margin-top: 10px; margin-bottom: 0; {% if inventory and inventory_type != 'DIGITAL' %}display: none;{% endif %}">
                <thead>
                  <tr>
					<td>{{ entry_product_id }}</td>
					<td>{{ entry_product_name }}</td>
					<td>{{ entry_product_weight }}</td>
					<td>{{ entry_product_price }}</td>
					<td>&nbsp;</td>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
					<td colspan="4">&nbsp;</td>
					<td class="left"><a onclick="addProduct();" class="btn btn-primary"><span>{{ button_add }}</span></a></td>
                  </tr>
                </tfoot>
                <tbody id="products">
				  {% set product_row = 0 %}
                  {% for product in products %}
                  <tr id="product_{{ product_row }}">
                    <td class="left"><input class="form-control" type="text" id="product_id_{{ product_row }}" name="products[{{ product_row }}][product_id]" value="{{ product['product_id'] }}" size="3" /></td>
                    <td class="left"><input class="form-control" type="text" id="product_name_{{ product_row }}" name="products[{{ product_row }}][name]" value="{{ product['name'] }}" size="50" /></td>
                    <td class="left"><input class="form-control" type="text" id="product_weight_{{ product_row }}" name="products[{{ product_row }}][weight]" value="{{ product['weight'] }}" size="10" /></td>
                    <td class="left"><input class="form-control" type="text" id="product_price_{{ product_row }}" name="products[{{ product_row }}][price]" value="{{ product['price'] }}" size="10" /></td>
                    <td class="left"><a onclick="$('#product_{{ product_row }}').remove();" class="btn btn-primary"><span>{{ button_remove }}</span></a></td>
                  </tr>
                  {% set product_row = product_row + 1 %}
                  {% endfor %}
                </tbody>
              </table>
              {% if error_inventory %}
              <br />&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_inventory }}</span>
              {% endif %}
            </div>
          </div>
		  <div class="form-group" id="econt_instruction">
            <label class="col-sm-3 control-label" for="instruction"><span data-toggle="tooltip" title="{{ help_entry_instructions }}">{{ entry_instructions }}</span></label>
            <div class="col-sm-9">
			  <select class="form-control" id="instruction" name="instruction" style="margin-bottom: 5px;" onchange="$('#get_instructions').toggle(); $('#instructions').toggle();">
				{% if instruction %}
				<option value="1" selected="selected">{{ text_yes }}</option>
				<option value="0">{{ text_no }}</option>
				{% else %}
				<option value="1">{{ text_yes }}</option>
				<option value="0" selected="selected">{{ text_no }}</option>
				{% endif %}
              </select>
              <span id="instructions_error"></span>
              <div id="instructions"{% if not shipping_econt_instruction %} style="display: none;"{% endif %}>
                <table class="table table-bordered table-hover" class="list" style="margin-bottom: 0;">
                  <thead>
                    <tr>
                      <td class="left">{{ entry_instructions_type }}</td>
                      <td class="left">{{ entry_instructions_list }}</td>
                    </tr>
                  </thead>
                  <tbody>
                    {% for instructions_type in instructions_types %}
                    <tr>
                      <td class="left">{{ instructions_type['title'] }}</td>
                      <td class="left">
                        <select class="form-control" id="econt_instructions_id_{{ instructions_type['code'] }}" name="shipping_econt_instructions_select[{{ instructions_type['code'] }}]" style="width: 300px;">
                          <option value="">{{ text_get_instructions }}</option>
                          {% if shipping_econt_instructions_id[instructions_type['code']] is defined %}
                            {% for instructions_id in shipping_econt_instructions_id[instructions_type['code']] %}
                            {{ shipping_econt_instructions_select[instructions_type['code']] }}
                              {% if shipping_econt_instructions_select[instructions_type['code']] == instructions_id %}
                              <option value="{{ instructions_id }}" selected="selected">{{ instructions_id }}</option>
                              {% else %}
                              <option value="{{ instructions_id }}">{{ instructions_id }}</option>
                              {% endif %}
                            {% endfor %}
                          {% endif %}
                        </select>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              {% if error_instruction %}
              <br />&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_instruction }}</span>
              {% endif %}
						</div>
				</div>
			</div>
      </form>
      <div class="pull-right">
        <a onclick="$('#form-econt :input').removeAttr('disabled'); $('#form-econt').submit();" class="btn btn-primary">{{ button_generate }}</a>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
      </div>
    </div>
   </div>
  </div>
</div>
<script type="text/javascript"><!--
	function receiveMessage(event) {
		if (event.origin !== '{{ office_locator_domain }}')
			return;

		message_array = event.data.split('||');
		getOfficeByOfficeCode(message_array[0]);
		$.magnificPopup.close();
	}

	if (window.addEventListener) {
		window.addEventListener('message', receiveMessage, false);
	} else if (window.attachEvent) {
		window.attachEvent('onmessage', receiveMessage);
	}

	$(document).ready(function() {
		if ($('#office_city_id').val()) {
			url = '{{ office_locator }}&address=' + $('#office_city_id option:selected').text();
		} else {
			url = '{{ office_locator }}';
		}

		$('a#office_locator').magnificPopup({
			type: 'iframe',
			  iframe: {
				patterns: {
				  bgmaps: {
					index: 'javascript:void(0);',
					src: url
				  }
				}
			  }
		 });

		$('#office_city_id').change(function () {
			if ($('#office_city_id').val()) {
				url = '{{ office_locator }}&address=' + $('#office_city_id option:selected').text();
			} else {
				url = '{{ office_locator }}';
			}

			$('a#office_locator').magnificPopup({
				type: 'iframe',
				  iframe: {
					patterns: {
					  bgmaps: {
						index: 'javascript:void(0);',
						src: url
					  }
					}
				  }
			 });
		});
	});

	function getOfficeByOfficeCode(office_code) {
		if (parseInt(office_code)) {
			$.ajax({
				url: 'index.php?route=extension/shipping/econt/getOfficeByOfficeCode&user_token={{ user_token }}',
				type: 'POST',
				data: 'office_code=' + parseInt(office_code),
				dataType: 'json',
				success: function(data) {
					if (!data.error) {
						$('#office_city_id').val(data.city_id);
						html = '<option value="0">{{ text_select }}</option>';

						for (i = 0; i < data.offices.length; i++) {
							html += '<option ';
							if (data.offices[i]['office_id'] == data.office_id) {
								html += 'selected="selected"';
							}
							html += 'value="' + data.offices[i]['office_id'] + '">' + data.offices[i]['office_code'] + ', ' + data.offices[i]['name'] + ', ' + data.offices[i]['address'] +  '</option>';
						}

						$('#office_id').html(html);
						$('#office_code').val(office_code);
					}
				}
			});
		}
	}
//--></script>
<script type="text/javascript"><!--
$(document).ready(function() {
	if ($('#delivery_day_id').is(':visible')) {
		changeDeliveryDay();
	}
});

function checkPriorityTime() {
	if ($('#priority_time_cb:checked').length) {
		$('#priority_time_type_id').removeAttr('disabled');
		$('#priority_time_hour_id').removeAttr('disabled');
	} else {
		$('#priority_time_type_id').attr('disabled', 'disabled');
		$('#priority_time_hour_id').attr('disabled', 'disabled');
	}
}

function checkDeliveryDay() {
	if ($('#delivery_day_cb:checked').length) {
		$('#delivery_day_id').removeAttr('disabled');
	} else {
		$('#delivery_day_id').attr('disabled', 'disabled');
	}
}

function changeDeliveryDay() {
	if ($('#delivery_day_id').val() == '{{ priority_date }}') {
		if (!$('#priority_time_cb:checked').length) {
			$('#priority_time_cb').attr('checked', true);
			$('#priority_time_type_id').removeAttr('disabled');
			$('#priority_time_type_id').val('BEFORE').attr('selected', 'selected');
			$('#priority_time_hour_id').removeAttr('disabled');
			$('#priority_time_hour_id').val('13');
		}
	} else {
		$('#priority_time_cb').attr('checked', false);
		$('#priority_time_type_id').attr('disabled', 'disabled');
		$('#priority_time_hour_id').attr('disabled', 'disabled');
	}
}

function displayInventoryType() {
	if ($('#inventory_type').val() == 'DIGITAL') {
		$('#inventory_type_loading').hide();
		$('#inventory_type_digital').show();
	} else if ($('#inventory_type').val() == 'LOADING') {
		$('#inventory_type_loading').show();
		$('#inventory_type_digital').hide();
	} else {
		$('#inventory_type_loading').hide();
		$('#inventory_type_digital').hide();
	}
}

var product_row = {{ product_row }};

function addProduct() {
	html  = '<tr id="product_' + product_row + '">';
	html += '  <td class="left"><input class="form-control" type="text" id="product_id_' + product_row + '" name="products[' + product_row + '][product_id]" value="" size="3" /></td>';
	html += '  <td class="left"><input class="form-control" type="text" id="product_name_' + product_row + '" name="products[' + product_row + '][name]" value="" size="50" /></td>';
	html += '  <td class="left"><input class="form-control" type="text" id="product_weight_' + product_row + '" name="products[' + product_row + '][weight]" value="" size="10" /></td>';
	html += '  <td class="left"><input class="form-control" type="text" id="product_price_' + product_row + '" name="products[' + product_row + '][price]" value="" size="10" /></td>';
	html += '  <td class="left"><a onclick="$(\'#product_' + product_row + '\').remove();" class="btn btn-primary"><span>{{ button_remove }}</span></a></td>';
	html += '</tr>';

	$('#products').append(html);

	product_row++;
}

function getInstructions() {
	$('#instructions_error').html('').removeClass("text-danger");
{% for instructions_type in instructions_types %}
	$('#instructions_id_{{ instructions_type['code'] }}').html('<option value="0">{{ text_wait }}</option>');
{% endfor %}

	$.ajax({
		url: 'index.php?route=extension/shipping/econt/getClients&user_token={{ user_token }}',
		type: 'POST',
		data: 'username={{ shipping_econt_username }}&password={{ shipping_econt_password }}&test={{ shipping_econt_test }}',
		dataType: 'json',
		success: function(data) {
			if (data) {
				if (data.instructions) {
{% for instructions_type in instructions_types %}
					html = '<option value="">{{ text_select }}</option>';

					if (data.instructions['{{ instructions_type['code'] }}']) {
						for (i = 0; i < data.instructions['{{ instructions_type['code'] }}'].length; i++) {
							if (data.instructions['{{ instructions_type['code'] }}'][i] && data.instructions['{{ instructions_type['code'] }}'][i].length) {
								html += '<option value="' + data.instructions['{{ instructions_type['code'] }}'][i] + '">' + data.instructions['{{ instructions_type['code'] }}'][i] + '</option>';
							}
						}
					}

					$('#instructions_id_{{ instructions_type['code'] }}').html(html);
					$('#instructions_id_{{ instructions_type['code'] }}').val($('#instructions_{{ instructions_type['code'] }}').val()).attr('selected', 'selected');
{% endfor %}
				} else if (data.error) {
					$('#instructions_error').html(data.error).addClass('text-danger');
				}
			}
		}
	});
}

function fillInstructions(type) {
	if ($('#instructions_id_' + type).val() != '') {
		$('#instructions_' + type).val($('#instructions_id_' + type).val());
	} else {
		$('#instructions_' + type).val('');
	}
}

function getInstructionsForm() {
	$.ajax({
		url: 'index.php?route=extension/shipping/econt/getProfile&user_token={{ user_token }}',
		type: 'POST',
		data: 'username={{ shipping_econt_username }}&password={{ shipping_econt_password }}&test={{ shipping_econt_test }}',
		dataType: 'json',
		success: function(data) {
			if (data) {
				if (data.instructions_form_url) {
					window.open(data.instructions_form_url, '', 'width=1050,height=800,location=no,menubar=no,resizable=yes,scrollbars=yes,status=no');
				} else if (data.error) {
					alert(data.error);
				}
			}
		}
	});
}

function getOfficesByCityId(aps, sender) {
	if (!aps) {
		if (typeof sender !== 'undefined') {
			$('#econt_office_code_sender').val('');
			office_city_id = $('#econt_office_city_id_sender').val();
			$('#econt_office_id_sender').html('<option value="0">{{ text_wait }}</option>');
		} else {
			$('#office_id').html('<option value="0">{{ text_wait }}</option>');
			$('#office_code').val('');
			office_city_id = $('#office_city_id').val();
		}
	} else {
		$('#office_aps_id').html('<option value="0">{{ text_wait }}</option>');
		$('#office_aps_code').val('');
		office_city_id = $('#office_city_aps_id').val();
	}

	$.ajax({
		url: 'index.php?route=extension/shipping/econt/getOfficesByCityId&user_token={{ user_token }}',
		type: 'POST',
		data: 'city_id=' + encodeURIComponent(office_city_id) + ((typeof sender !== 'undefined') ? '' : '&aps=' + encodeURIComponent(aps)),
		dataType: 'json',
		success: function(data) {
			if (data) {
				html = '<option value="0">{{ text_select }}</option>';

				for (i = 0; i < data.length; i++) {
					html += '<option value="' + data[i]['office_id'] + '">' + data[i]['office_code'] + ', ' + data[i]['name'] + ', ' + data[i]['address'] +  '</option>';
				}

				if (!aps) {
					if (typeof sender !== 'undefined') {
						$('#econt_office_id_sender').html(html);
					} else {
						$('#office_id').html(html);
					}
				} else {
					$('#office_aps_id').html(html);
				}
			}
		}
	});
}

function getOffice(aps, sender) {
	if (!aps) {
		if (typeof sender !== 'undefined') {
			$('#econt_office_code_sender').val('');
			office_id = $('#econt_office_id_sender').val();
		} else {
			$('#office_code').val('');
			office_id = $('#office_id').val();
		}
	} else {
		$('#office_aps_code').val('');
		office_id = $('#office_aps_id').val();
	}

	$.ajax({
		url: 'index.php?route=extension/shipping/econt/getOffice&user_token={{ user_token }}',
		type: 'POST',
		data: 'office_id=' + encodeURIComponent(office_id),
		dataType: 'json',
		success: function(data) {
			if (data) {
				if (!aps) {
					if (typeof sender !== 'undefined') {
						$('#econt_office_code_sender').val(data.office_code);
					} else {
						$('#office_code').val(data.office_code);
					}
				} else {
					$('#office_aps_code').val(data.office_code);
				}
			}
		}
	});
}
//--></script>

<script type="text/javascript"><!--
	var sender_post_code = '{{ receiver_address['sender_post_code'] }}';
	var econt_city = '{{ receiver_address['city'] }}';
	var econt_quarter = '{{ receiver_address['quarter'] }}';
	var econt_street = '{{ receiver_address['street'] }}';

	$('#city').autocomplete({
		'source': function(request, response) {
			$.ajax({
				url: 'index.php?route=extension/shipping/econt/getCitiesByName&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
				dataType: 'json',
				success: function(json) {
					response($.map(json, function(item) {
						return {
							label:     item['post_code'] + ' ' + item['name'],
							value:     item['post_code'] + ' ' + item['name'],
							name:      item['name'],
							city_id:   item['city_id'],
							post_code: item['post_code']
						}
					}));
				}
			});
		},
		'select': function(item) {
			if (item) {
				econt_city = item.name;
				$('#city').val(item.name);
				$('#city_id').val(item.city_id);
				$('#post_code').val(item.post_code);
				$('#quarter').val('');
				$('#street').val('');
				$('#street_num').val('');
				$('#other').val('');
			}
		},
		'change': function(item) {
			if(!item) {
				$('#city').val('');
				$('#city_id').val('');
				$('#post_code').val('');
			}

			$('#quarter').val('');
			$('#street').val('');
			$('#street_num').val('');
			$('#other').val('');
		}
	});

	$('#city').blur(function() {
		if ($(this).val() != econt_city) {
			$(this).val('');
			$('#city_id').val('');
			$('#post_code').val('');
			$('#quarter').val('');
			$('#street').val('');
			$('#street_num').val('');
			$('#other').val('');
		}
	});

	$('#quarter').autocomplete({
		'source': function(request, response) {
			$.ajax({
				url: 'index.php?route=extension/shipping/econt/getQuartersByName&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request) + '&city_id=' +  encodeURIComponent($('#city_id').val()),
				dataType: 'json',
				success: function(json) {
					response($.map(json, function(item) {
						return {
							label: item['name'],
							value: item['name']
						}
					}));
				}
			});
		},
		'select': function(item) {
			if (item) {
				econt_quarter = item.label;
				$('#quarter').val(item['label']);
			}
		},
		'change': function(item) {
			if(!item) {
				$('#quarter').val('');
			}
		}
	});

	$('#quarter').blur(function() {
		if ($(this).val() != econt_quarter) {
			$('#quarter').val('');
		}
	});

	$('#street').autocomplete({
		'source': function(request, response) {
			$.ajax({
				url: 'index.php?route=extension/shipping/econt/getStreetsByName&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request) + '&city_id=' +  encodeURIComponent($('#city_id').val()),
				dataType: 'json',
				success: function(json) {
					response($.map(json, function(item) {
						return {
							label: item['name'],
							value: item['name']
						}
					}));
				}
			});
		},
		'select': function(item) {
			if (item) {
				econt_street = item.label;
				$('#street').val(item['label']);
			}
		},
		'change': function(item) {
			if(!item) {
				$('#street').val('');
			}
		}
	});

	$('#street').blur(function() {
		if ($(this).val() != econt_street) {
			$('#street').val('');
		}
	});
//--></script></div>
{{ footer }}
